From d04983e353a3d3ca2d8cb14ca706eaccdcaff704 Mon Sep 17 00:00:00 2001
From: Lubomir Rintel <lkundrak@v3.sk>
Date: Wed, 5 May 2010 08:48:37 +0200
Subject: [PATCH] Fix build with more recent poppler

---
 src/extension/internal/pdfinput/pdf-parser.cpp |   19 +++++++++++++------
 1 files changed, 13 insertions(+), 6 deletions(-)

diff --git a/src/extension/internal/pdfinput/pdf-parser.cpp b/src/extension/internal/pdfinput/pdf-parser.cpp
index b37cbb7..006e614 100644
--- a/src/extension/internal/pdfinput/pdf-parser.cpp
+++ b/src/extension/internal/pdfinput/pdf-parser.cpp
@@ -56,6 +56,13 @@ extern "C" {
 #define M_PI 3.14159265358979323846
 #endif
 
+#include <glib/poppler-features.h>
+#if POPPLER_CHECK_VERSION(0,12,2)
+#define PGFX ,NULL
+#else
+#define PGFX
+#endif
+
 //------------------------------------------------------------------------
 // constants
 //------------------------------------------------------------------------
@@ -1020,9 +1027,9 @@ void PdfParser::opSetFillColorSpace(Object args[], int numArgs) {
   }
 #else
   if (obj.isNull()) {
-    colorSpace = GfxColorSpace::parse(&args[0]);
+    colorSpace = GfxColorSpace::parse(&args[0] PGFX);
   } else {
-    colorSpace = GfxColorSpace::parse(&obj);
+    colorSpace = GfxColorSpace::parse(&obj PGFX);
   }
 #endif
   obj.free();
@@ -1051,9 +1058,9 @@ void PdfParser::opSetStrokeColorSpace(Object args[], int numArgs) {
   }
 #else
   if (obj.isNull()) {
-    colorSpace = GfxColorSpace::parse(&args[0]);
+    colorSpace = GfxColorSpace::parse(&args[0] PGFX);
   } else {
-    colorSpace = GfxColorSpace::parse(&obj);
+    colorSpace = GfxColorSpace::parse(&obj PGFX);
   }
 #endif
   obj.free();
@@ -1128,7 +1135,7 @@ void PdfParser::opSetFillColorN(Object args[], int numArgs) {
     }
 #else
     if (args[numArgs-1].isName() &&
-	(pattern = res->lookupPattern(args[numArgs-1].getName()))) {
+	(pattern = res->lookupPattern(args[numArgs-1].getName() PGFX))) {
       state->setFillPattern(pattern);
       builder->updateStyle(state);
     }
@@ -1180,7 +1187,7 @@ void PdfParser::opSetStrokeColorN(Object args[], int numArgs) {
     }
 #else
     if (args[numArgs-1].isName() &&
-	(pattern = res->lookupPattern(args[numArgs-1].getName()))) {
+	(pattern = res->lookupPattern(args[numArgs-1].getName() PGFX))) {
       state->setStrokePattern(pattern);
       builder->updateStyle(state);
     }
-- 
1.7.0.1

